# Money Flow 需求规格说明书 (SRS)

## 1. 项目概述

**Money Flow** 是一款基于 Web 的个人财务管理应用，旨在帮助用户轻松记录收支、管理账户资产、规划预算以及通过数据可视化分析财务状况。项目采用现代化前端技术栈构建，强调交互体验与数据隐私（本地化存储）。

## 2. 技术架构

- **前端框架**: Vue 3 (Composition API + `<script setup>`)
- **构建工具**: Vite
- **状态管理**: Pinia (Setup Store模式)
- **UI 样式**: Tailwind CSS v4
- **图标库**: Lucide Vue Next
- **图表库**: Chart.js + vue-chartjs
- **日期处理**: date-fns
- **数据存储**: LocalStorage (浏览器本地存储)

## 3. 功能模块详解

### 3.1 用户认证 (User Authentication)
用户身份验证与授权功能，确保数据安全。

- **用户注册**:
  - 支持邮箱注册新账户。
  - 必填信息：用户名、邮箱、密码。
  - 密码需满足安全要求（建议至少 8 位，包含字母和数字）。
- **用户登录**:
  - 支持邮箱密码登录。
  - 登录成功后获取 JWT Token，用于后续 API 请求的身份验证。
  - Token 自动存储在本地，刷新页面后保持登录状态。
- **退出登录**:
  - 清除本地存储的 Token 和用户信息。
  - 退出后跳转至登录页面。
- **身份验证**:
  - 所有受保护的 API 请求需在 Header 中携带 JWT Token。
  - Token 过期或无效时自动跳转至登录页面。
  - 路由守卫保护需要登录才能访问的页面。

### 3.2 交易管理 (Transaction Management)
核心功能，用于记录每一笔资金流动。

- **记账功能**:
  - 支持记录三种类型的交易：**支出**、**收入**、**转账**。
  - **必填信息**: 金额、日期、账户（转账需选择转出/转入账户）、分类。
  - **选填信息**: 备注、标签（支持多标签）。
  - **多币种支持**: 记录交易时可记录原币种金额，系统基于汇率折算为本位币。
- **交易列表**:
  - **筛选**: 支持按 **年**、**月**、**日** 维度筛选交易记录。
  - **标签筛选**: 支持按标签过滤特定属性的交易。
  - **排序**: 支持按 **日期**、**金额**、**分类名称** 进行升序或降序排列。
  - **展示**: 清晰展示交易分类图标、名称、金额、账户及日期。
- **编辑与删除**: 支持对已生成的交易记录进行二次编辑或删除。

### 3.3 账户资产管理 (Account Management)
管理用户的资金存放位置。

- **账户类型**: 预设现金、银行卡、支付宝、微信支付等类型，支持自定义。
- **资产概览**: 实时计算各账户余额及总资产（初始余额 + 收入 - 支出 ± 转账）。
- **账户操作**:
  - **新增账户**: 自定义账户名称、类型、图标及初始余额。
  - **编辑/删除**: 修改账户信息；若账户下存在关联交易，禁止删除以保证数据一致性。

### 3.4 预算管理 (Budget Management)
帮助用户控制消费，避免超支。

- **月度预算**:
  - 支持按月设置总预算金额。
  - 支持对特定 **支出分类** 单独设置子预算。
- **预算监控**:
  - 实时展示预算使用进度条。
  - **超支预警**: 当支出超过预算一定比例（如80%、100%）时，提供视觉反馈或建议。
- **智能建议**: 基于当前预算执行情况，提供“复盘建议”（如：某分类超支警告、储蓄率偏低提醒）。

### 3.5 统计与分析 (Statistics & Analysis)
核心功能，用于可视化展示财务状况，并支持报表导出。

- **收支概览**: 展示当前筛选时间段内的总收入、总支出、结余及储蓄率。
- **支出排行**:
  - 按分类统计支出金额及占比。
  - 提供排行榜视图，直观展示消费结构。
  - 支持点击分类查看该分类下的具体交易笔数。
- **图表展示**:
  - **环形图/饼图**: 展示各类目支出/收入占比，图例中直接显示百分比。
  - **交互优化**: 隐藏冗余图例，提升小屏幕下的展示效果。
- **数据导出**:
  - **PDF 导出**: 支持将当前统计报表导出为 PDF 格式，包含概览、图表及明细列表。
  - **Excel 导出**: 支持将筛选后的交易明细导出为 .xlsx 格式，包含日期、类型、分类、说明、账户、金额等详细字段，方便用户进行二次加工。

### 3.6 周期性账单 (Recurring Transactions)
自动化处理固定频率的收支。

- **规则配置**: 设置金额、分类、账户、频率（每天/每周/每月/每年）及开始时间。
- **默认分类**: 分类项默认预选为"其他支出"（支出类型）或"其他收入"（收入类型）。如果用户未修改分类，系统将自动使用该默认分类（ID: exp_other 或 inc_other）。
- **自动生成**: 系统启动时自动检查，若达到预定时间，自动生成对应的交易记录。
- **管理**: 支持暂停、删除或修改周期性任务配置。

### 3.7 储蓄目标 (Savings Goals)
激励用户存钱的功能。

- **目标设定**: 创建目标（如“买房”、“旅行”），设置目标金额、截止日期、专属图标及颜色。
- **进度追踪**:
  - 存入/取出资金操作，实时更新当前已筹金额。
  - 可视化进度条展示完成度。
  - 计算距离目标的剩余金额及时间。

### 3.7 分类管理 (Category Management)
灵活的收支分类体系。

- **多级分类**: 支持两级分类结构（父分类 -> 子分类）。
- **预设数据**: 系统内置常用的衣食住行等分类。
- **自定义**:
  - 用户可添加新的父分类或子分类。
  - 支持修改分类名称及图标。
  - 删除分类时会校验是否被交易记录引用，保障数据完整性。

### 3.9 设置与数据 (Settings)
- **汇率管理**: 集成汇率 API，支持手动或自动更新汇率数据，用于多币种折算。
- **数据持久化**: 所有业务数据通过 API 与后端同步，刷新页面后自动从服务器获取最新数据。JWT Token 和汇率缓存临时存储在 LocalStorage 中。

## 4. 业务规则与约束

1.  **金额逻辑**:
    - 支出记为负向流出，收入记为正向流入。
    - 转账不影响总资产，只改变不同账户间的余额分布。
2.  **删除约束**:
    - 包含关联数据的实体（如已被交易使用的账户或分类）不可直接删除，需先处理关联数据。
3.  **时间处理**:
    - 所有日期存储为 ISO 格式，前端展示时根据本地化设置（zh-CN）格式化。

## 5. 界面与交互要求

- **响应式设计**: 适配桌面端与移动端访问。
- **视觉反馈**: 操作成功/失败需有 Toast 通知提示。
- **空状态**: 列表为空时需展示友好的引导页或插图。
- **主题色**: 
    - 收入: 翡翠绿 (Emerald)
    - 支出: 玫瑰红 (Rose)
    - 余额/转账: 蓝色 (Blue/Primary)
    - 预算/警告: 橙色 (Orange)
